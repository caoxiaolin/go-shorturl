language: go

go:
  - 1.10.x

services:
  - postgresql

before_install:
  - go get -v github.com/caoxiaolin/go-shorturl

before_script:
  - psql -c "CREATE DATABASE shorturl;" -U postgres
  - psql -c "CREATE TABLE url (id bigserial, url character varying, hits bigint, create_time timestamp, last_access_time timestamp, PRIMARY KEY (id));" -U postgres
  - go run shorturl.go &
  - curl -d "url=http://www.google.com" "http://127.0.0.1:4000"
  - curl "http://127.0.0.1/1" -b "debug=1"

script:
  - go test -v ./tests/
